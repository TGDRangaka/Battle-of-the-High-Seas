var oe=Object.defineProperty;var ne=(e,t,s)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var k=(e,t,s)=>(ne(e,typeof t!="symbol"?t+"":t,s),s);import{i as re,g as le,a as de,o as he,$ as i,r as f,b as v,d as M,m as ce,j as C,e as L,h as b,f as S,u as I,n as ge,l as fe,c as pe}from"./Ship-CbUz4hjx.js";const ue="/Battle-of-the-High-Seas/assets/board-bg2-BJ8gmd7w.gif",me=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"})),ye="/Battle-of-the-High-Seas/assets/captain-nvN02mGO.png",be=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"})),_e="/Battle-of-the-High-Seas/assets/easy-CfFsWiJe.jpg",Se=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"})),Ae="/Battle-of-the-High-Seas/assets/explotion-hVssOnqr.gif",ve=Object.freeze(Object.defineProperty({__proto__:null,default:Ae},Symbol.toStringTag,{value:"Module"})),Ie="/Battle-of-the-High-Seas/assets/game-bg-BNC7camq.jpg",Te=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"})),Ce="/Battle-of-the-High-Seas/assets/hard-B1UgResD.jpg",Ee=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"})),we="/Battle-of-the-High-Seas/assets/hit-shot-C5IocONJ.jpg",je=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"})),xe="/Battle-of-the-High-Seas/assets/lobby-bg-Doj_4GKl.jpg",Oe=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"})),Ye="/Battle-of-the-High-Seas/assets/logo-NdU70Ygn.png",Be=Object.freeze(Object.defineProperty({__proto__:null,default:Ye},Symbol.toStringTag,{value:"Module"})),Ne="/Battle-of-the-High-Seas/assets/message-bg-ChXeVhNe.jpg",Re=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"})),Me="/Battle-of-the-High-Seas/assets/missed-shot-CZNQCz4t.png",ze=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"})),Pe="/Battle-of-the-High-Seas/assets/normal-CU3sVZgG.jpg",He=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"})),ke="/Battle-of-the-High-Seas/assets/ship-2-1-Ctcwa05g.png",De=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"})),We="/Battle-of-the-High-Seas/assets/ship-3-1-DBkbElqy.png",Le=Object.freeze(Object.defineProperty({__proto__:null,default:We},Symbol.toStringTag,{value:"Module"})),Ue="/Battle-of-the-High-Seas/assets/ship-3-2-BJPXlfHt.png",Ge=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"})),Ve="/Battle-of-the-High-Seas/assets/ship-4-1-C4W2Nih_.png",Je=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"})),Qe="data:image/png;base64,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",Ke=Object.freeze(Object.defineProperty({__proto__:null,default:Qe},Symbol.toStringTag,{value:"Module"})),qe="/Battle-of-the-High-Seas/assets/ship-5-1-DqDdTOJq.png",Ze=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"})),Fe="/Battle-of-the-High-Seas/assets/ship-6-1-BbM6-ehE.png",$e=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"}));class Xe{constructor(t,s,o,n){k(this,"isHaveWinner");k(this,"winner");k(this,"selectedCell");k(this,"firedShotStatus");this.isHaveWinner=t,this.winner=s,this.selectedCell=o,this.firedShotStatus=n}}var W=(e=>(e.HIT="hit",e.MISS="miss",e.DESTROYED="destroyed",e.NOT_FIRED="not_fired",e))(W||{}),O=(e=>(e.PLAYER_MISS="player_miss",e.PLAYER_HIT="player_hit",e.PLAYER_SINK="player_sink",e.ENEMY_MISS="enemy_miss",e.ENEMY_HIT="enemy_hit",e.ENEMY_SINK="enemy_sink",e))(O||{});function N(e){switch(e){case"player_miss":return R(et);case"player_hit":return R(tt);case"player_sink":return R(st);case"enemy_miss":return R(it);case"enemy_hit":return R(at);case"enemy_sink":return R(ot);default:return""}}const R=e=>{const t=Math.floor(Math.random()*e.length);return e[t]},et=["You missed! Better luck next time.","Splash! Your shot landed in the water.","No hit! The enemy ship is safe.","Try again! Your shot missed the target.","Oops! That was a miss.","Keep going! You can do better.","The enemy is still afloat, you missed!","Your shot went wide of the mark.","Miss! The enemy dodged your attack.","No luck this time, aim carefully!"],tt=["Direct hit! The enemy ship is damaged.","Nice shot! You hit the enemy.","Boom! You scored a hit.","Great aim! The enemy ship took a hit.","Hit confirmed! The enemy is hurting.","Well done! You hit their ship.","Bullseye! The enemy ship is struck.","You're on target! Another hit.","The enemy ship is taking damage, good shot!","Your shot hit its mark!"],st=["You sank an enemy ship! Well done!","Enemy ship destroyed! Great job!","Fantastic! You sunk their ship.","Boom! Enemy ship has been sunk.","Congratulations! You took down their ship.","Enemy vessel down! You're on fire!","One less enemy ship to worry about!","Great work! The enemy ship is sinking.","You've obliterated their ship!","Victory! An enemy ship is sinking."],it=["The enemy missed! Your ship is safe.","Splash! The enemy shot landed in the water.","No hit! The enemy failed to strike.","Phew! The enemy shot missed you.","The enemy missed the mark.","You're safe! The enemy's shot went wide.","The enemy shot didn't find its target.","The enemy missed your ship!","Their shot went astray.","The enemy's attack was unsuccessful."],at=["The enemy hit your ship!","Direct hit by the enemy!","Your ship took a hit!","The enemy scored a hit!","Boom! The enemy hit your ship.","Your ship is damaged!","The enemy shot hit its mark.","Ouch! Your ship was struck.","Your ship is taking damage!","The enemy's attack was successful."],ot=["Oh no! The enemy sank your ship!","Your ship has been destroyed by the enemy.","The enemy took down your ship!","Enemy victory! Your ship is sinking.","Your ship is gone! The enemy sank it.","The enemy obliterated your ship!","You've lost a ship to the enemy.","One of your ships has been sunk!","Disaster! The enemy sank your vessel.","Your ship is sinking!"],nt={apiKey:"AIzaSyAL0AmcXBH1zr7EKL8pE3-Joge0Pxyljfg",authDomain:"battle-of-the-high-seas.firebaseapp.com",databaseURL:"https://battle-of-the-high-seas-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"battle-of-the-high-seas",storageBucket:"battle-of-the-high-seas.appspot.com",messagingSenderId:"95988470782",appId:"1:95988470782:web:b745e9ce5edeeebbe566af",measurementId:"G-ZVDQNVR4JY"};re(nt);const p=le(),rt=new URLSearchParams(window.location.search);let u=rt.get("roomId");const F=de();let U,$,X;he(F,async e=>{if(e){$=f(p,"users/"+e.uid),U=e.uid;try{X=await v($),X.exists()}catch(t){console.error("Error fetching user data:",t)}}else fe(F).catch(t=>{console.error("Error signing in anonymously:",t)})});let P,a,_,z,c;const J=i("#dropzone");let ee;const H=f(p,"rooms/"+u);v(H).then(e=>{if(e.exists()){z=e.val();const t=new Map(Object.entries(z.players||{}));i("#roomId").text(`ROOM ID: #${z.roomId}`);const s=t.get(U);s&&(a=s,P=f(p,`rooms/${u}/players/${U}`),i(".player .player-name").text(a.name),a.state===M.NOT_READY&&i("#readyBtn").prop("disabled",!0)),c=s.board.size,ht(s.board),ee=i(".cells"),ee&&lt()}else console.error("no room to get...")});ce(f(p,`rooms/${u}/players`),e=>{e.exists()&&e.val().id!==U&&(_=e.val(),i(".enemy .player-name").text(_.name),E("Player Joined"))});let Q=!1;C(f(p,`rooms/${u}/players`),async e=>{if(Q)return;if((await v(H)).val().status!==L.WAITING){ie(),se(),!Q&&ae();return}const s=new Map(Object.entries(e.val()||{}));let o=[!1,!1];s.forEach((n,l)=>{l===U?n.state!==M.NOT_READY&&(o[0]=!0):n.state!==M.NOT_READY&&(o[1]=!0)}),o[0]&&o[1]&&I(H,{status:L.PLAYING}).then(()=>{ie(),se(),a.state=M.PLAYING,I(P,a),ae()}).catch(n=>console.log("error updating room status to playing",n))});let D=null;function lt(){i(".guide-pane, #dropzone").on("dragstart",".ship",function(e){if(z.status!==L.WAITING)return;D=i(this);const t=a.ships.find(n=>n.id===D.attr("id"));if(!t)return!1;const s=i(this).data("size").split("x"),o=parseInt(s[0]);J.on("dragover",".cell",function(n){n.preventDefault();let l=i(".cell").index(this),r=[];for(let d=0;d<o;d++){let A=t.direction===b.ROW?d:d*c;const q=l+A;r.push(q)}i(".cell").removeClass("highlight"),i(".cell").removeClass("warning"),te(l,t)?r.map(d=>i(".cell").eq(d).addClass("highlight")):r.map(d=>i(".cell").eq(d).addClass("warning"))})}),J.on("drop",".cell",function(e){if(z.status!==L.WAITING)return;const t=i(this).data("index"),s=a.ships.find(o=>o.id===D.attr("id"));if(s){if(te(t,s)){e.preventDefault(),i(".cell").removeClass("highlight"),i(".cell").removeClass("warning"),i(this).prepend(D);const o=a.ships.find(n=>n.id===D.attr("id"));o&&(o.index=t,o.status=S.PLACED,a.ships.filter(n=>n.status===S.INACTIVE).length==0?i("#readyBtn").prop("disabled",!1):i("#readyBtn").prop("disabled",!0),I(P,a).catch(n=>console.log("error while updating ships",n)));return}i(".cell").removeClass("highlight"),i(".cell").removeClass("warning")}}),J.on("click",".cell",function(){if(z.status!==L.WAITING)return;const e=i(this).data("index"),t=a.ships.find(s=>s.index===e);t&&(ct(t,a.ships)?(t.direction===b.COLUMN?(i(".cell").eq(t.index).find(".ship").attr("direction","row"),t.direction=b.ROW):(i(".cell").eq(t.index).find(".ship").attr("direction","column"),t.direction=b.COLUMN),I(P,{ships:a.ships}).catch(s=>console.log("error while updating ships",s))):(i(".cell").eq(e).addClass("warning"),setTimeout(()=>{i(".cell").eq(e).removeClass("warning")},1500)))}),dt(a.ships),gt(a.ships,"#player-board")}i("#readyBtn").on("click",function(){a.state===M.NOT_READY&&I(P,{state:M.READY}).then(()=>{}).catch(e=>console.log("error while updating ships",e))});const w=e=>{const t=`/src/assets/imgs/${e}`,o=Object.assign({"/src/assets/imgs/board-bg2.gif":me,"/src/assets/imgs/captain.png":be,"/src/assets/imgs/easy.jpg":Se,"/src/assets/imgs/explotion.gif":ve,"/src/assets/imgs/game-bg.jpg":Te,"/src/assets/imgs/hard.jpg":Ee,"/src/assets/imgs/hit-shot.jpg":je,"/src/assets/imgs/lobby-bg.jpg":Oe,"/src/assets/imgs/logo.png":Be,"/src/assets/imgs/message-bg.jpg":Re,"/src/assets/imgs/missed-shot.png":ze,"/src/assets/imgs/normal.jpg":He,"/src/assets/imgs/ship-2-1.png":De,"/src/assets/imgs/ship-3-1.png":Le,"/src/assets/imgs/ship-3-2.png":Ge,"/src/assets/imgs/ship-4-1.png":Je,"/src/assets/imgs/ship-4-2.png":Ke,"/src/assets/imgs/ship-5-1.png":Ze,"/src/assets/imgs/ship-6-1.png":$e})[t];return o?o.default:""};function dt(e){for(let t of e){const s=w(t.id+".png");t.status===S.INACTIVE&&i(".guide-pane .ships").append(`
                <div id="${t.id}" class="ship" draggable="true" data-size="${t.size}" direaction="column">
                    <img src="${s}">
                </div>
            `),i(".fleet .ships").append(`
            <div id="${t.id}" class="ship" data-size="${t.size}" direaction="column">
                <div class="health">${'<div class="health-point"></div>'.repeat(t.length)}</div>
                <img src="${s}">
            </div>
        `)}}function ht(e){const t=e.size*e.size;for(let s=0;s<t;s++)J.append(`<div data-index="${s}" class="cell"></div>`),i("#enemy-board .board").append(`<div data-index="${s}" class="cell"></div>`);i(".board").css({gridTemplateColumns:`repeat(${c}, 1fr)`,gridTemplateRows:`repeat(${c}, 1fr)`})}function te(e,t){let s=e%c;const o=Math.floor(e/c);let n=!0;if(t.direction===b.ROW){if(s+t.length>c)return!1;e:for(let l=0;l<t.length;l++){let r=e+l;for(let d of a.ships)if(d.status!==S.INACTIVE&&d.id!==t.id){if(d.direction===b.ROW){if(d.index===r){n=!1;break e}}else for(let A=0;A<d.length;A++)if(r===d.index+A*c){n=!1;break e}}}if(!n)return!1}else{if(o+t.length>c)return!1;e:for(let l=0;l<t.length;l++){let r=e+l*c;for(let d of a.ships)if(d.status!==S.INACTIVE&&d.id!==t.id){if(d.direction===b.COLUMN){if(d.index===r){n=!1;break e}}else for(let A=0;A<d.length;A++)if(r===d.index+A){n=!1;break e}}}if(!n)return!1}return!0}function ct(e,t){let s=!0;const o=e.index;if(e.direction===b.ROW){if(Math.floor(o/c)+e.length>c)return!1;for(let n=1;n<e.length;n++){let l=o+n*c;if(l>=c*c||(t.forEach(r=>{if(r.status!==S.INACTIVE&&r.id!==e.id){if(r.direction===b.COLUMN){if(r.index===l){s=!1;return}}else if(r.index<=l&&r.index+r.length>l){s=!1;return}}}),!s))return!1}}else{if(o%c+e.length>c)return!1;for(let n=1;n<e.length;n++){let l=o+n;if(t.forEach(r=>{if(r.status!==S.INACTIVE&&r.id!==e.id){if(r.direction===b.ROW){if(r.index===l){s=!1;return}}else for(let d=0;d<r.length;d++)if(l===r.index+d*c){s=!1;return}}}),!s)return!1}}return!0}function gt(e,t){for(let s of e)if(s.status!=S.INACTIVE){const o=s.index,n=s.direction,l=w(s.id+".png");let r=i(`${t} .cell`).eq(o);n==b.ROW?r.append(`
                <div id="${s.id}" class="ship" draggable="true" data-size="${s.size}" direction="row">
                    <img src="${l}" alt="">
                </div>
                `):r.append(`
                <div id="${s.id}" class="ship" draggable="true" data-size="${s.size}" direction="column">
                    <img src="${l}" alt="">
                </div>
                `)}a.ships.filter(s=>s.status===S.INACTIVE).length==0?i(".player button").prop("disabled",!1):i(".player button").prop("disabled",!0)}function se(){a.ships.map(e=>{const t=e.index;if(e.direction===b.ROW)for(let o=0;o<e.length;o++)a.board.grid[t+o].inside=e.id;else for(let o=0;o<e.length;o++)a.board.grid[t+o*c].inside=e.id})}function ie(){i(".guide-pane").hide(),i(".board-area + .right").show(),i("aside").removeClass("hidden"),i("#readyBtn").hide(),i("#dropzone .ship[draggable='true']").attr("draggable","false"),i("#dropzone .ship").css("zIndex","-1"),i("#turnPlayerName").show()}async function ae(){if(Q)return;i(".cell").append("<div class='shot'></div>"),v(pe(f(p),`rooms/${u}/gameStat`)).then(m=>{m.exists()||I(H,{gameStat:new Xe(!1,null,-1,W.NOT_FIRED)}).then(()=>{}).catch(g=>console.error("Error while adding game stat",g))});const e=f(p,`rooms/${u}/turn`),t=f(p,`rooms/${u}/gameStat`),s=f(p,`rooms/${u}/gameStat/isHaveWinner`),o=f(p,`rooms/${u}/gameStat/selectedCell`),n=f(p,`rooms/${u}/players/${_.id}/board/grid`),l=f(p,`rooms/${u}/players/${a.id}/board/grid`),r=f(p,`rooms/${u}/players/${a.id}/ships`),d=f(p,`rooms/${u}/players/${_.id}/ships`),A=f(p,`rooms/${u}/players/${_.id}`);let K=(await v(f(p,`rooms/${u}/players/${_.id}/board/grid`))).val(),Z=(await v(f(p,`rooms/${u}/players/${a.id}/board/grid`))).val();C(e,async m=>{if((await v(s)).val())return;const h=m.val();i("#turnPlayerName").text(h==a.id?"YOUR TURN":"ENEMY TURN"),i("#turnPlayerName").css("color",h==a.id?"#9DFF21":"#ff2121")}),i("#enemy-board .board").on("click",".cell",async function(){if((await v(e)).val()===a.id){const g=i(this).index();if(K[g].isHit)return;await I(t,{selectedCell:g})}}),C(o,async m=>{const g=await v(A),h=m.val(),Y=await v(e);if(h!=-1)if(Y.val()===a.id){_=g.val();const j=_.board.grid[h];if(j.inside!=="empty"){let T=_.ships.findIndex(y=>y.id===j.inside);if(_.ships[T].health>1)E(N(O.PLAYER_HIT)),V([h],"#enemy-board");else{E(N(O.PLAYER_SINK));const y=_.ships[T].index;let B=[];for(let x=0;x<_.ships[T].length;x++)B.push(y+(_.ships[T].direction==b.ROW?x:x*c));V(B,"#enemy-board")}return}E(N(O.PLAYER_MISS))}else{const j=a.board.grid[h];let T=W.MISS;if(a.board.grid[h].isHit=!0,j.inside!=="empty"){let y=a.ships.findIndex(B=>B.id===j.inside);if(!a.ships[y])return;if(a.ships[y].health>1)a.ships[y].health=a.ships[y].health-1,a.ships[y].status=S.DAMAGED,T=W.HIT,E(N(O.ENEMY_HIT)),V([h],"#player-board");else{a.ships[y].health=0,a.ships[y].status=S.DESTROYED,T=W.DESTROYED,E(N(O.ENEMY_SINK));const B=a.ships[y].index;let x=[];for(let G=0;G<a.ships[y].length;G++)x.push(B+(a.ships[y].direction==b.ROW?G:G*c));V(x,"#player-board")}}else E(N(O.ENEMY_MISS));await I(t,{firedShotStatus:T}),I(P,a).then(async()=>{ft(a.ships)&&await I(t,{isHaveWinner:!0,winner:_}),await I(H,{turn:a.id})}).catch(y=>console.log("error updating the player after attack",y))}}),C(l,async m=>{Z=m.val(),Z.map((g,h)=>{g.isHit&&i("#player-board .board .cell .shot").eq(h).html(g.inside==="empty"?`<img src="${w("missed-shot.png")}" alt="missed"/>`:`<img src="${w("hit-shot.jpg")}" alt="fire"/>`)})}),C(n,async m=>{K=m.val(),K.map((g,h)=>{g.isHit&&i("#enemy-board .board .cell .shot").eq(h).html(g.inside==="empty"?`<img src="${w("missed-shot.png")}" alt="missed"/>`:`<img src="${w("hit-shot.jpg")}" alt="fire"/>`)})}),C(r,m=>{const g=m.val();for(let h of g){let Y=h.length,j=Y-h.health;for(;j--!=0;)i(`.player1-fleet #${h.id} .health-point`).eq(--Y).addClass("health-none")}}),C(d,m=>{const g=m.val();for(let h of g)h.status==S.DESTROYED&&i(`.player2-fleet #${h.id} .health-point`).addClass("health-none")}),C(s,async m=>{if(m.val()){const h=(await v(f(p,`rooms/${u}/gameStat/winner`))).val();E("Winner is "+h.name),i("#enemy-board .board").off("click",".cell"),i("#turnPlayerName").text(h.id==a.id?"YOU WIN":"ENEMY WIN"),i("#turnPlayerName").css("color",h.id==a.id?"#9DFF21":"#ff2121");const Y=await v(A);pt(Y.val().ships)}}),Q=!0}function ft(e){return e.filter(t=>t.status===S.DESTROYED).length===e.length}i("#exitButton").click(async function(){await ge(H)});function E(e){i("#messages").append(`
        <div class="message">
            <div class="img"></div>
            <div class="body">
                <p>${e}</p>
            </div>
        </div>
    `),setTimeout(()=>i("#messages").empty(),3e3)}function pt(e){for(let t of e){const s=t.index,o=t.direction,n=w(t.id+".png");let l=i("#enemy-board .cell").eq(s);o==b.ROW?l.append(`
            <div id="${t.id}" class="ship" data-size="${t.size}" direction="row">
                <img src="${n}" alt="">
            </div>
            `):l.append(`
            <div id="${t.id}" class="ship" data-size="${t.size}" direction="column">
                <img src="${n}" alt="">
            </div>
            `)}}function V(e,t){for(let s of e)i(`${t} .board .cell`).eq(s).append(`
            <div class="boom"><img src="${w("explotion.gif")}" alt="boom"/>
        `);setTimeout(()=>{i(`${t} .boom`).remove()},1e3)}
